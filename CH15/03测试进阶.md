# 03 测试-进阶

#### Markdown Notes 创建于 2024-08-11T04:12:50.300Z

## 测试组

测试一下 split 函数对中文字符串的支持，可以再编写一个 TestChineseSplit 测试函数，但是我们也可以使用如下更友好的一种方式来添加更多的测试用例。。

```go
func TestGroupSplit(t *testing.T) {
   // 定义一个测试用例类型
    type test struct {
        input string
        sep   string
        want  []string
    }
    // 定义一个存储测试用例的切片
    tests := []test{
        {input: "a:b:c", sep: ":", want: []string{"a", "b", "c"}},
        {input: "a:b:c", sep: ",", want: []string{"a:b:c"}},
        {input: "abcd", sep: "bc", want: []string{"a", "d"}},
        {input: "枯藤老树昏鸦", sep: "老", want: []string{"枯藤", "树昏鸦"}},
    }
    //
    //tests := map[string]test{ // 测试用例使用map存储
    //    "simple":      {input: "a:b:c", sep: ":", want: []string{"a", "b", "c"}},
    //    "wrong sep":   {input: "a:b:c", sep: ",", want: []string{"a:b:c"}},
    //    "more sep":    {input: "abcd", sep: "bc", want: []string{"a", "d"}},
    //    "leading sep": {input: "枯藤老树昏鸦", sep: "老", want: []string{"枯藤", "树昏鸦"}},
    //}
    // 遍历切片，逐一执行测试用例
    for _, tc := range tests {
        got := Split(tc.input, tc.sep)
        if !reflect.DeepEqual(got, tc.want) {
            t.Errorf("excepted:%v, got:%v", tc.want, got)
        }
    }
}
```

失败：`split_test.go:42: excepted:[枯藤 树昏鸦], got:[ 枯藤 树昏鸦]`。
发现`[ 枯藤 树昏鸦]`中有个不明显的空串，这种情况下十分推荐使用`%#v`的格式化方式。
`t.Errorf("excepted:%#v, got:%#v", tc.want, got)`
`split_test.go:42: excepted:[]string{"枯藤", "树昏鸦"}, got:[]string{"", "枯藤", "树昏鸦"}`

## 子测试

Go1.7+中新增了子测试，`T.Run()`

```go
for name, tc := range tests {
    t.Run(name, func(t *testing.T) { // 使用t.Run()执行子测试
        got := Split(tc.input, tc.sep)
        if !reflect.DeepEqual(got, tc.want) {
            t.Errorf("excepted:%#v, got:%#v", tc.want, got)
        }
    })
}
```

`go test -v -run=Split/simple` 只会运行 simple 对应的子测试用例。

## 测试覆盖率

测试覆盖率是你的代码被测试套件覆盖的百分比。通常我们使用的都是语句的覆盖率，也就是在测试中至少被运行一次的代码占总代码的比例。
使用`go test -cover`来查看测试覆盖率。

```
$ go test -cover
    PASS
    coverage: 100.0% of statements
```

从上面的结果可以看到我们的测试用例覆盖了 100%的代码。

`-coverprofile`参数，用来将覆盖率相关的记录信息输出到一个文件。
`go test -cover -coverprofile=c.out`
上面的命令会将覆盖率相关的信息输出到当前文件夹下面的 `c.out` 文件中，然后我们执行 `go tool cover -html=c.out`，使用 cover 工具来处理生成的记录信息，该命令会打开本地的浏览器窗口生成一个 HTML 报告。
