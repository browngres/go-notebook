# 01 结构体-基础

#### Markdown Notes 创建于 2024-08-02T10:44:59.585Z

Go 语言中没有“类”的概念，也不支持“类”的继承等面向对象的概念。
Go 语言中通过结构体的内嵌再配合接口比面向对象具有更高的扩展性和灵活性。

Go 语言中的基础数据类型可以表示一些事物的基本属性，但是当我们想表达一个事物的全部或部分属性时，这时候再用单一的基本数据类型明显就无法满足需求了，Go 语言提供了一种自定义数据类型，可以封装多个基本数据类型，这种数据类型叫结构体，英文名称 struct。也就是我们可以通过 struct 来定义自己的类型了。
Golang 仍然有面向对象编程的继承，封装和多态的特性，只是实现的方式和其它 OOP 语言不一样，比如继承：Golang 没有 extends 关键字，继承是通过匿名字段来实现。
Golang 面向对象(OOP)很优雅，OOP 本身就是语言类型系统(type system)的一部分，通过接口(interface)关联，耦合性低，也非常灵活。后面同学们会充分体会到这个特点。也就是说在 Golang 中面向接口编程是非常重要的特性。

```go
type 类型名 struct {
    字段名 字段类型
    字段名 字段类型
    …
}
```

-   类型名：标识自定义结构体的名称，在同一个包内不能重复。
-   字段名：表示结构体字段名。结构体中的字段名必须唯一。
-   字段类型：表示结构体字段的具体类型。可以是基本类型、数组或引用类型
-   结构体是值类型

```go
type person struct {
    name string
    city string
    age  int8
}
// 同样类型的字段也可以写在一行
type person1 struct {
    name, city string
    age        int8
}
```

## 结构体实例化

只有当结构体实例化时，才会真正地分配内存。也就是必须实例化后才能使用结构体的字段。
`var 结构体实例 结构体类型`

```go
var p1 person
p1.name = "123"
p1.city = "北京"
p1.age = 18
fmt.Printf("p1=%v\n", p1)  //p1={123 北京 18}
fmt.Printf("p1=%#v\n", p1) //p1=main.person{name:"123", city:"北京", age:18}
```

我们通过小数点`.`来访问结构体的字段（成员变量）,例如 `p1.name` 和 `p1.age` 等。

## 使用键值对初始化

```go
p5 := person{
    name: "123",
    city: "北京",
    age:  18,
}
```

-   没有指定初始值的字段的值就是该字段类型的零值。
-   使用&对结构体进行取地址操作相当于对该结构体类型进行了一次 new 实例化操作。
-   初始化结构体的时候可以简写，也就是初始化的时候不写键，直接写值：

```go
p8 := &person{
    "123",
    "北京",
    18,
}
```

1. 必须初始化结构体的所有字段。
2. 初始值的填充顺序必须与字段在结构体中的声明顺序一致。
3. 该方式不能和键值初始化方式混用。

## 匿名结构体

`var user struct{Name string; Age int}`

## 创建指针类型结构体

还可以通过使用 new 关键字对结构体进行实例化，得到的是结构体的地址。

```go
var p2 = new(person)
fmt.Printf("%T\n", p2)     //*main.person
fmt.Printf("p2=%#v\n", p2) //p2=&main.person{name:"", city:"", age:0}
p2.age = 18
p2.city = "北京"
```

需要注意的是在 Go 语言中支持对结构体指针直接使用.来访问结构体的成员。

使用&对结构体进行取地址操作相当于对该结构体类型进行了一次 new 实例化操作。
`p3 := &person{}` 等价于 `var p3 = new(person)`

## 结构体变量在内存的布局

-   结构体的所有字段在内存中是连续的
-   `var p2 *Person = &p1 ` 使用了一个指针。这时 p2 和 p1 就是指向同一片区域了。此时的 `p2.age` 等价于 `(*p2).age` ， 但是 `*p2.age` 是错误的。因为 `.`的优先级高于`*`。
